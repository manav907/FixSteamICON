"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const timeoutPromise_1 = __importDefault(require("./timeoutPromise"));
/**
 * Return a new promise that will also invoke the callback, if provided. Also has timeout functionality as in timeoutPromise.
 * @param {number} timeout - Timeout in milliseconds. If this value is <= 0, then the timeout functionality is disabled.
 * @param {string[]|null} callbackArgs - If null, the entire result object is just passed to the callback as the 2nd arg (1 is err)
 * @param {function|null} callback
 * @param {boolean} [isOptional=false] - If true, then the app won't crash if the user neither provides a callback nor adds a `catch` listener
 * @param {function} executor
 * @returns {Promise}
 */
function timeoutCallbackPromise(timeout, callbackArgs, callback, isOptional, executor) {
    if (typeof isOptional === 'function') {
        executor = isOptional;
        isOptional = false;
    }
    let promise = (0, timeoutPromise_1.default)(timeout, executor);
    if (typeof callback === 'function' || isOptional) {
        promise.then((result) => {
            if (typeof callback === 'function') {
                setImmediate(() => {
                    let args = callbackArgs ? callbackArgs.map(argName => typeof result[argName] === 'undefined' ? null : result[argName]) : [result];
                    callback(null, ...args);
                });
            }
        }).catch((err) => {
            if (typeof callback === 'function') {
                callback(err);
            }
        });
    }
    return promise;
}
exports.default = timeoutCallbackPromise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZW91dENhbGxiYWNrUHJvbWlzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvcHJvbWlzZXMvdGltZW91dENhbGxiYWNrUHJvbWlzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHNFQUE4QztBQUU5Qzs7Ozs7Ozs7R0FRRztBQUNILFNBQXdCLHNCQUFzQixDQUM3QyxPQUFlLEVBQ2YsWUFBMkIsRUFDM0IsUUFBNkMsRUFDN0MsVUFBbUIsRUFDbkIsUUFHUTtJQUVSLElBQUksT0FBTyxVQUFVLEtBQUssVUFBVSxFQUFFO1FBQ3JDLFFBQVEsR0FBRyxVQUFVLENBQUM7UUFDdEIsVUFBVSxHQUFHLEtBQUssQ0FBQztLQUNuQjtJQUVELElBQUksT0FBTyxHQUFHLElBQUEsd0JBQWMsRUFBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFFaEQsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLElBQUksVUFBVSxFQUFFO1FBQ2pELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRTtZQUN2QixJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRTtnQkFDbkMsWUFBWSxDQUFDLEdBQUcsRUFBRTtvQkFDakIsSUFBSSxJQUFJLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNsSSxRQUFRLENBQUMsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBQ3pCLENBQUMsQ0FBQyxDQUFDO2FBQ0g7UUFDRixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUNoQixJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRTtnQkFDbkMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ2Q7UUFDRixDQUFDLENBQUMsQ0FBQztLQUNIO0lBRUQsT0FBTyxPQUFPLENBQUM7QUFDaEIsQ0FBQztBQWpDRCx5Q0FpQ0MifQ==